<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf8">
    <title>web/workflow/grunt.md 正文 - 白衣染霜华</title>
    <link rel="stylesheet" href="/css/adc39f9c.app.css">
    <link href="/css/06f85b78.main.css" rel="stylesheet">
  </head>
  <body>
    <div class="narrow"><h1 id="-">安装</h1>
<p>安装<code>grunt-cli</code></p>
<pre><code>npm install -g grunt-cli
</code></pre><p>grunt-cli运行时调用本地的grunt来执行，所以npm本地依赖中也要有grunt。</p>
<h1 id="-">使用</h1>
<p>列出所有可用的task</p>
<pre><code>grunt --help
</code></pre><p>执行grunt的task</p>
<pre><code>grunt [task [task ...]]
</code></pre><p>不加参数运行default任务。可以加很多任务。</p>
<p>添加插件时，使用如下命令加入package.json的devDependencies</p>
<pre><code>npm install &lt;module&gt; --save-dev.
</code></pre><h1 id="gruntfile-js">Gruntfile.js</h1>
<p>基本摹本</p>
<pre><code class="lang-js">&#39;use strict&#39;;
module.exports = function (grunt) {
  grunt.loadNpmTasks(&#39;grunt-contrib-connect&#39;);
  var config = {
    app: &#39;sites&#39;,
    dist: &#39;dist&#39;
  };
  grunt.initConfig({
    config: config,
    connect: {
      server: {
        options: {
          livereload: true,
          base: &#39;sites&#39;,
          port: 9000,
          open: true
        }
      }
    }
  });
  grunt.registerTask(&#39;serve&#39;, [
  &#39;connect&#39;,
  &#39;watch&#39;
  ]);
  grunt.registerTask(&#39;default&#39;, [
  &#39;serve&#39;
  ]);
};
</code></pre>
<h2 id="-">常用的插件包</h2>
<h3 id="grunt-contrib-concat">grunt-contrib-concat</h3>
<h3 id="grunt-contrib-connect">grunt-contrib-connect</h3>
<p>load task</p>
<pre><code>grunt.loadNpmTasks(&#39;grunt-contrib-connect&#39;);
</code></pre><p>config</p>
<pre><code>connect: {
  server: {
    options: {
      livereload: true,
      base: &#39;sites&#39;,
      port: 9000,
      open: true
    }
  }
}
</code></pre><p>task name: <code>connect</code></p>
<h3 id="grunt-contrib-cssmin">grunt-contrib-cssmin</h3>
<h3 id="grunt-contrib-less">grunt-contrib-less</h3>
<p>load task</p>
<pre><code>grunt.loadNpmTasks(&#39;grunt-contrib-less&#39;);
</code></pre><p>config</p>
<pre><code>less: {
  development: {
    files: {
      &quot;sites/css/main.css&quot;: &quot;less/main.less&quot;
    }
  }
}
</code></pre><p>task name: <code>less</code></p>
<h3 id="grunt-contrib-uglify">grunt-contrib-uglify</h3>
<h3 id="grunt-contrib-watch">grunt-contrib-watch</h3>
<p>load task</p>
<pre><code>grunt.loadNpmTasks(&#39;grunt-contrib-watch&#39;);
</code></pre><p>config</p>
<pre><code>watch: {
  less: {
    files: [&#39;less/main.less&#39;],
    tasks: [&#39;less&#39;],
    options: {
      // Start a live reload server on the default port 35729
      livereload: true,
    },
  }
}
</code></pre><p>task name: <code>watch</code></p>
<h3 id="grunt-gh-pages">grunt-gh-pages</h3>
<p>load task</p>
<pre><code>grunt.loadNpmTasks(&#39;grunt-gh-pages&#39;);
</code></pre><p>config</p>
<pre><code>&#39;gh-pages&#39;: {
  options: {
    base: &#39;sites&#39;
  },
  src: [&#39;**&#39;]
},
</code></pre><p>task name: <code>gh-pages</code></p>
<h3 id="grunt-shell">grunt-shell</h3>
<p>load task</p>
<pre><code>grunt.loadNpmTasks(&#39;grunt-shell&#39;);
</code></pre><p>config</p>
<pre><code>shell: {
  listFolders: {
    options: {
      stderr: false
    },
    command: &#39;ls&#39;
  }
}
</code></pre><p>task name: <code>shell</code></p>
<h3 id="grunt-usemin">grunt-usemin</h3>
<p>config</p>
<pre><code>useminPrepare: {
  options: {
    dest: &#39;sites&#39;
  },
  html: &#39;sites/index.html&#39;
},
usemin: {
  options: {
    // assetsDirs: [&#39;&lt;%= config.dist %&gt;&#39;, &#39;&lt;%= config.dist %&gt;/images&#39;]
  },
  html: [&#39;sites/**/*.html&#39;],
  // css: [&#39;&lt;%= config.dist %&gt;/styles/{,*/}*.css&#39;]
},
</code></pre><p>task flow:</p>
<pre><code>grunt.registerTask(&#39;build&#39;, [
&#39;useminPrepare&#39;,
&#39;concat&#39;,
&#39;cssmin&#39;,
&#39;uglify&#39;,
// &#39;filerev&#39;,
&#39;usemin&#39;
]);
</code></pre><p>会在运行时生成concat, cssmin, uglify的配置文件，所以不需要写它们的配置文件。<br>但是要自己写task的流程。</p>
<p>html的写法</p>
<pre><code class="lang-html">&lt;!--build:css /css/app.css--&gt;
&lt;link href=&quot;../bower_components/bootstrap/dist/css/bootstrap.min.css&quot; rel=&quot;stylesheet&quot;&gt;
&lt;link href=&quot;../bower_components/google-code-prettify/src/prettify.css&quot; rel=&quot;stylesheet&quot;&gt;
&lt;link href=&quot;/css/main.css&quot; rel=&quot;stylesheet&quot;&gt;
&lt;!--endbuild--&gt;
&lt;!--build:js /js/app.js--&gt;
&lt;script src=&quot;../bower_components/jquery/dist/jquery.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;../bower_components/bootstrap/dist/js/bootstrap.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;../bower_components/google-code-prettify/src/prettify.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;../bower_components/keymaster/keymaster.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;../js/main.js&quot;&gt;&lt;/script&gt;
&lt;!--endbuild--&gt;
</code></pre>
<p>grunt会将此句子替换为生成的<code>app.css</code>和<code>app.js</code></p>
<h3 id="grunt-rev">grunt-rev</h3>
<p>使用<code>grunt-filerev</code>不行，会生成新的文件夹<code>src</code>，里面包含带有rev的文件，而不是直接替换。</p>
<p>使用<code>grunt-rev</code>会直接替换目标文件。</p>
<p>安装</p>
<pre><code>npm install grunt-rev --save-dev
</code></pre><p>配置：</p>
<pre><code class="lang-js">rev: {
  dist: {
    files: {
      src: [
        &#39;sites/css/*.css&#39;,
        &#39;sites/js/*.js&#39;
      ]
    }
  }
}
</code></pre>
<p>使用</p>
<pre><code class="lang-js">grunt.registerTask(&#39;build&#39;, [
&#39;shell&#39;,
&#39;less&#39;,
&#39;useminPrepare&#39;,
&#39;concat&#39;,
&#39;cssmin&#39;,
&#39;uglify&#39;,
// &#39;filerev&#39;,
&#39;rev&#39;,
&#39;usemin&#39;
]);
</code></pre>
<p>注意：如果使用<code>rev</code>，则<code>usemin</code>配置应改为</p>
<pre><code class="lang-js">usemin: {
  options: {
    assetsDirs: [&#39;sites&#39;]
  },
  html: [&#39;sites/**/*.html&#39;],
}
</code></pre>
<p>即加上assertsDirs配置。如果不加，生成的html中不会带有版本号。加上就可以了。</p>
<h2 id="grunt-contrib-copy">grunt-contrib-copy</h2>
<p>安装</p>
<pre><code>npm install grunt-contrib-copy --save-dev
</code></pre><p>配置</p>
<pre><code class="lang-js">copy: {
  main: {
    files: [
      {
        expend: true,
        src: [
          &#39;CNAME&#39;,
          &#39;404.html&#39;
        ],
        dest: &#39;&lt;%= config.dist %&gt;/&#39;
      }
    ]
  }
}
</code></pre>
<p>注意：dest的字符串后要加<code>/</code>表示这是目录。</p>
<p>还可以使用<code>cwd</code>选项指明<code>src</code>的根。</p>
<p>使用</p>
<pre><code>&#39;copy:main&#39;
</code></pre><h1 id="-">通配符</h1>
<pre><code>* # matches any number of characters, but not /
? # matches a single character, but not /
** # matches any number of characters, including /, as long as it&#39;s the only thing in a path part
{} # allows for a comma-separated list of &quot;or&quot; expressions
! # at the beginning of a pattern will negate the match
</code></pre><p>例子:</p>
<pre><code>// You can specify single files:
{src: &#39;foo/this.js&#39;, dest: ...}
// Or arrays of filges:
{src: [&#39;foo/this.js&#39;, &#39;foo/that.js&#39;, &#39;foo/the-other.js&#39;], dest: ...}
// Or you can generalize with a glob pattern:
{src: &#39;foo/th*.js&#39;, dest: ...}

// This single node-glob pattern:
{src: &#39;foo/{a,b}*.js&#39;, dest: ...}
// Could also be written like this:
{src: [&#39;foo/a*.js&#39;, &#39;foo/b*.js&#39;], dest: ...}

// All .js files, in foo/, in alpha order:
{src: [&#39;foo/*.js&#39;], dest: ...}
// Here, bar.js is first, followed by the remaining files, in alpha order:
{src: [&#39;foo/bar.js&#39;, &#39;foo/*.js&#39;], dest: ...}

// All files except for bar.js, in alpha order:
{src: [&#39;foo/*.js&#39;, &#39;!foo/bar.js&#39;], dest: ...}
// All files in alpha order, but with bar.js at the end.
{src: [&#39;foo/*.js&#39;, &#39;!foo/bar.js&#39;, &#39;foo/bar.js&#39;], dest: ...}

// Templates may be used in filepaths or glob patterns:
{src: [&#39;src/&lt;%= basename %&gt;.js&#39;], dest: &#39;build/&lt;%= basename %&gt;.min.js&#39;}
// But they may also reference file lists defined elsewhere in the config:
{src: [&#39;foo/*.js&#39;, &#39;&lt;%= jshint.all.src %&gt;&#39;], dest: ...}
</code></pre><pre><code>exports.warnOn = &#39;Gruntfile.js&#39;;        // Warn on a Gruntfile.js file.
exports.warnOn = &#39;*.js&#39;;            // Warn on any .js file.
exports.warnOn = &#39;*&#39;;               // Warn on any non-dotfile or non-dotdir.
exports.warnOn = &#39;.*&#39;;              // Warn on any dotfile or dotdir.
exports.warnOn = &#39;{.*,*}&#39;;          // Warn on any file or dir (dot or non-dot).
exports.warnOn = &#39;!*/**&#39;;           // Warn on any file (ignoring dirs).
exports.warnOn = &#39;*.{png,gif,jpg}&#39;; // Warn on any image file.

// This is another way of writing the last example.
exports.warnOn = [&#39;*.png&#39;, &#39;*.gif&#39;, &#39;*.jpg&#39;];
</code></pre></div>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      
      ga('create', 'UA-50872903-2', 'auto');
      ga('send', 'pageview');
      
    </script>
    <script src="/js/925a7cfc.app.js"></script>
  </body>
</html>