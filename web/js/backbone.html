<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf8">
    <title>Post</title>
    <link rel="stylesheet" href="/css/app.css"/>
    <link href="/css/main.css" rel="stylesheet">
  </head>
  <body>
    <div class="narrow"><blockquote>
<p>“Get your truth out of the DOM”</p>
<p>Jeremy Ashkenas</p>
</blockquote>
<h1 id="model">Model</h1>
<h2 id="-">基本用法</h2>
<ul>
<li>继承自空的对象</li>
<li>用JSON数据初始化一个实体</li>
</ul>
<pre><code class="lang-js">var TodoItem = Backbone.Model.extend({});
var todoItem = new TodoItem(
  { description: &#39;Pick up milk&#39;, status: &#39;incomplete&#39;, id: 1 }
);
</code></pre>
<ul>
<li>得到模型的属性值</li>
<li>设置属性</li>
<li>保存到服务器(需要设置)</li>
</ul>
<pre><code class="lang-js">todoItem.get(&#39;description&#39;);
todoItem.set({status: &#39;complete&#39;});
todoItem.save();
</code></pre>
<p>可以指定默认值</p>
<pre><code class="lang-js">var TodoItem = Backbone.Model.extend({
  defaults: {
    description: &#39;Empty todo...&#39;,
    status: &#39;incomplete&#39;
  }
});
￼￼￼￼￼￼￼var todoItem = new TodoItem();
todoItem.get(&#39;description&#39;);
</code></pre>
<h2 id="-">与服务端同步</h2>
<ul>
<li>设置url</li>
<li>拉回数据并填充</li>
</ul>
<pre><code class="lang-js">var todoItem = new TodoItem();
todoItem.url = &#39;/todo&#39;;
todoItem.fetch();
// =&gt; { id: 1, description: &#39;Pick up milk&#39;, status: &#39;incomplete&#39; }
todoItem.get(&#39;description&#39;);
</code></pre>
<p>更好的方式: RESTful API</p>
<p>使用urlRoot创建一个新的Model</p>
<pre><code class="lang-js">var TodoItem = Backbone.Model.extend({urlRoot: &#39;/todos&#39;});
</code></pre>
<ul>
<li>使用<code>id</code>初始化一个实体,fetch时就会往<code>/todos/:id</code>上发GET</li>
<li>save会触发<code>PUT /todos/:id</code>+参数</li>
</ul>
<pre><code class="lang-js">var todoItem = new TodoItem({id: 1});
todoItem.fetch(); // =&gt; GET /todos/1
todoItem.set({description: &#39;Pick up cookies.&#39;});
todoItem.save() // PUT /todos/1 with params
</code></pre>
<ul>
<li>初始化实体时没有指定<code>id</code>,则在<code>save</code>的时候会自动加上.</li>
<li>没有<code>fetch</code>的情况下直接<code>save</code>会触发<code>POST</code>请求</li>
</ul>
<pre><code class="lang-js">var todoItem = new TodoItem();
todoItem.set({description: &#39;Fill prescription.&#39;});
todoItem.save(); // =&gt; POST /todos with params
todoItem.get(&quot;id&quot;); // =&gt; 2. update id automaticly
</code></pre>
<p>其他模型上的函数</p>
<pre><code class="lang-js">todoItem.destroy(); // =&gt; DELETE /todos/2
todoItem.toJSON(); // get JSON from model
// =&gt; { id: 2, description: &#39;Fill prescription&#39;, status: &#39;incomplete&#39; }
</code></pre>
<h2 id="-">事件监听</h2>
<p>自定义事件</p>
<pre><code class="lang-js">￼todoItem.on(&#39;event-name&#39;, function(){
  alert(&#39;event-name happened!&#39;);
});
todoItem.trigger(&#39;event-name&#39;);
</code></pre>
<p>内置事件</p>
<pre><code class="lang-js">todoItem.on(&#39;change&#39;, doThing); // function doThing(){}
todoItem.set({description: &#39;Fill prescription.&#39;});
￼todoItem.set({description: &#39;Fill prescription.&#39;}, {silent: true});
todoItem.off(&#39;change&#39;, doThing);
</code></pre>
<table>
<thead>
<tr>
<th style="text-align:left">事件名称</th>
<th style="text-align:left">触发条件</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">change</td>
<td style="text-align:left">模型中的任何属性改变</td>
</tr>
<tr>
<td style="text-align:left">destroy</td>
<td style="text-align:left">模型被销毁</td>
</tr>
<tr>
<td style="text-align:left">sync</td>
<td style="text-align:left">成功同步</td>
</tr>
<tr>
<td style="text-align:left">error</td>
<td style="text-align:left">模型<code>save</code>或者验证失败</td>
</tr>
<tr>
<td style="text-align:left">all</td>
<td style="text-align:left">所有被<code>trigger</code>的事件</td>
</tr>
</tbody>
</table>
<h1 id="view">View</h1>
<h2 id="-">简单用法</h2>
<p>View类和View实体</p>
<pre><code class="lang-js">var TodoView = Backbone.View.extend({});
var todoView = new TodoView({ model: todoItem });
</code></pre>
<h2 id="html-">html渲染</h2>
<p>View类中包含render函数</p>
<pre><code class="lang-js">var TodoView = Backbone.View.extend({
  render: function(){
    var html = &#39;&lt;h3&gt;&#39; + this.model.get(&#39;description&#39;) + &#39;&lt;/h3&gt;&#39;;
    $(this.el).html(html);
  }
});

var todoView = new TodoView({ model: todoItem });
todoView.render();
console.log(todoView.el);
</code></pre>
<p>will output:</p>
<pre><code class="lang-html">&lt;div&gt;
  &lt;h3&gt;Pick up milk&lt;/h3&gt;
&lt;/div&gt;
</code></pre>
<p>每一个view都有一个最高层元素,默认是div.改变:</p>
<pre><code class="lang-js">var SimpleView = Backbone.View.extend({tagName: &#39;li&#39;});
</code></pre>
<p>还可以加上<code>id</code>和<code>class</code></p>
<pre><code class="lang-js">var TodoView = Backbone.View.extend({
  tagName: &#39;article&#39;,
  id: &#39;todo-view&#39;,
  className: &#39;todo&#39;
});
</code></pre>
<p><code>todoView.el</code>是<code>DOM Element</code>,使用<code>jQuery</code>访问</p>
<pre><code class="lang-js">$(&#39;#todo-view&#39;).html();
$(todoView.el).html();
todoView.$el.html(); // 最好
</code></pre>
<h2 id="-underscore-">配合underscore使用</h2>
<p>View模型</p>
<pre><code class="lang-js">var TodoView = Backbone.View.extend({
  template: _.template(‘&lt;h3&gt;&lt;%= description %&gt;&lt;/h3&gt;’),
  render: function(){
    var attributes = this.model.toJSON();
    this.$el.html(this.template(attributes));
  }
});
</code></pre>
<p>使用</p>
<pre><code class="lang-js">￼var todoView = new TodoView({ model: todoItem });
todoView.render();
console.log(todoView.el);
</code></pre>
<p>输出</p>
<pre><code class="lang-html">&lt;article id=&quot;todo-view&quot; class=&quot;todo&quot;&gt;
  &lt;h3&gt;Pick up milk&lt;/h3&gt;
&lt;/article&gt;
</code></pre>
<h2 id="view-">View上的事件监听</h2>
<p>语法: <code>&quot;&lt;event&gt; &lt;selector&gt;&quot;: &quot;&lt;method&gt;&quot;</code></p>
<pre><code class="lang-js">var TodoView = Backbone.View.extend({
  events: {
    &quot;click h3&quot;: &quot;alertStatus&quot;,
    &quot;dblclick&quot; : &quot;funcX&quot; // EL中的任何地方
  },
  alertStatus: function(e){
    alert(&#39;Hey you clicked the h3!&#39;);
} })
</code></pre>
<p>等价于</p>
<pre><code class="lang-js">this.$el.delegate(&#39;h3&#39;, &#39;click&#39;, alertStatus);
</code></pre>
</div>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      
      ga('create', 'UA-50872903-1', 'lihebi.com');
      ga('send', 'pageview');
      
    </script>
    <script src="/js/app.js"></script>
  </body>
</html>